name: pushartifact
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
jobs:
  build:
    runs-on: ubuntu-latest
    env: 
      BLOB_URL: https://sharppromotionapitest.blob.core.windows.net
      
    outputs:
      reponame: ${{ steps.reponame.outputs.reponame}}
      versionid: ${{ steps.versionid.outputs.versionid}}  

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
     - uses: actions/checkout@v1
     
     - name: get repo name
       id: reponame
       run: echo "::set-output name=reponame::${GITHUB_REPOSITORY#*/}"
       
     - name: version
       id: versionid
       run: echo "::set-output name=versionid::1"  
       
     - name: get repo name
       run: | 
           mkdir test
           echo hello > test/world1.txt
     
     - name: store zip
       run: zip -r ${{steps.reponame.outputs.reponame}}_${{steps.versionid.outputs.versionid}}.zip test

     - name: Login to Azure
       uses: azure/login@v1
       with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}
        
     - name: uplode file to Azure blob storage
       run: azcopy copy '${{steps.reponame.outputs.reponame}}_${{steps.versionid.outputs.versionid}}.zip' '${{env.BLOB_URL}}/${{steps.reponame.outputs.reponame}}/${{steps.reponame.outputs.reponame}}_${{steps.versionid.outputs.versionid}}.zip${{ secrets.AZURE_STORAGE_CONNECTION_STRING }}'

